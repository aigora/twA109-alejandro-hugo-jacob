#include <Servo.h>
#define N 300

Servo myservo;

const int LedPin = 13;
const int Potenciometro = A0;

//prototipos de las funciones

void intervalo(int valor);
float calculo_media_y_max_min (float _v[], int _dim, float *max, float *min);

void setup(){
  Serial.begin(9600);
  pinMode(LedPin, OUTPUT);
  digitalWrite(LedPin, LOW);
  myservo.attach(9);
}
 
void loop(){
  char dato,j;
  int i,dim=N;
  float media,v[N],max,min;
  
  if (Serial.available() > 0){
    dato = Serial.read();
    if (dato  == '0') 
      digitalWrite(LedPin, LOW);

    if (dato  == '1') 
      digitalWrite(LedPin, HIGH);
     
    if (dato  == '2'){
      for(i=0;i<N;i++){
        valor=analogRead(Potenciometro);
        v[i]=valor;
        intervalo(valor);
      }
      
    Serial.println("El vector guardado es:  ");	//imprime el vector por pantalla
    for(i=0;i<N;i++){
      Serial.println(v[i]);
    }
    
      media=calculo_media_y_max_min(v,dim,&max,&min);
      Serial.print("La media es:  ");
      Serial.println(media);
      Serial.print("El max es:  ");
      Serial.println(max);
      Serial.print("El min es:  ");
      Serial.println(min);
      delay(5000);
    }
  }
}

/*	=============================================================	FUNCIONES	==============================================	*/

void intervalo(int valor){
  
  if(valor>=0 && valor<500)
    Serial.println("Entre 0 y 500");
  
  else{
    if(valor>=500 && valor<600){
      digitalWrite(LedPin, HIGH);
      valor = map(valor, 0, 1023, 0, 180);     // mapeo para poner al servo entre 0 y180
      myservo.write(valor);                  // lo mueve a esa posicion
      delay(15);
    }
    if(valor>=600 && valor<700){
      digitalWrite(LedPin, LOW);
      valor = map(valor, 0, 1023, 0, 180);
      myservo.write(valor);
      delay(15);
    }
    if(valor>=700 && valor<800){
      digitalWrite(LedPin, HIGH);
      valor = map(valor, 0, 1023, 0, 180);
      myservo.write(valor);
      delay(15);
    }
    if(valor>=800 && valor<900){
      digitalWrite(LedPin, LOW);
      valor = map(valor, 0, 1023, 0, 180);
      myservo.write(valor);
      delay(15);
    }
    if(valor>=900 && valor<=1023){
      digitalWrite(LedPin, HIGH);
      valor = map(valor, 0, 1023, 0, 180);
      myservo.write(valor);
      delay(15);
    }
   // Serial.println(valor);
  }
}



float calculo_media_y_max_min (float _v[], int _dim, float *max, float *min){
	
	float valor_medio,sum=0;
	int i;
	
	*max=_v[0];
	*min=_v[0];
	for(i=0;i<_dim;i++){
		sum+=_v[i];
		if(_v[i]>*max)
			*max=_v[i];
		else
			if(_v[i]<*min)
				*min=_v[i];
	}

	valor_medio=sum/_dim;
	return valor_medio;
}
